function Flipboard(){function e(){var e,t=R.width(),a=Math.max(R.height(),d.height());r=Math.ceil(t/MAX_WIDTH);do C=Math.floor(t/r),e=a/(C/ASPECT_RATIO),f=Math.ceil(e);while(f-e>=.5&&t/r>=MIN_WIDTH&&r++);I=Math.floor(a/f),d.show().css({width:r*C+"px",height:f*I+"px",left:"50%",top:"50%"})}function t(){var e,t=0,n=r*f>!c.length;while(r*f>c.length){var T=new Image;e=$(S()),d.append(e),c[c.length]=e[0],N[c.length-1]=T,!Modernizr.csstransforms3d&&$(BACK_FACE,e[0]).hide(),l?s(e[0]):($(T).load(function(){if(t++,t>=r*f){for(var e=t-1;e>=0;e--)s(c[e],!1,N[e]);F=!0,o()}}),T.src=a())}while(c.length>r*f)$(c.pop()).remove();$(c).width(C).height(I),E=[],n&&F&&o()}function a(){return u&&u.length||(u=_.shuffle(PHOTOS)),u.shift()}function n(){return E&&E.length||(E=_.shuffle(c)),E.shift()}function s(e,t,s){function o(){T(function(){_.$face.empty().removeClass(PORTRAIT_CLASS),l&&(l.height>l.width&&_.$face.addClass(PORTRAIT_CLASS),_.$face.append(l)),i.addClass(_.addClass).removeClass(_.removeClass),!Modernizr.csstransforms3d&&(_.addClass==TRANSITION_TO_FRONT&&$(BACK_FACE,i).fadeOut("slow")&&$(FRONT_FACE,i).fadeIn("slow")||$(FRONT_FACE,i).fadeOut("slow")&&$(BACK_FACE,i).fadeIn("slow"))})}t=!!t;var _,i=$(FRAME_SELECTOR,e||n()),l=t?null:s?s:new Image;_=i.hasClass(TRANSITION_TO_BACK)?{$face:$(FRONT_FACE,i),addClass:TRANSITION_TO_FRONT,removeClass:TRANSITION_TO_BACK}:{$face:$(BACK_FACE,i),addClass:TRANSITION_TO_BACK,removeClass:TRANSITION_TO_FRONT},l&&l.src?o():l?($(l).load(o),l.src=a()):o()}function T(e){e&&typeof e=="function"&&L.push(e),A||(A=window.setInterval(function(){L.length?L.shift()():(window.clearInterval(A),A=null)},25))}function o(){l||(l=window.setInterval(function(){s()},FLIP_INTERVAL)),d.addClass(FLIPBOARD_CLASS_ON_PLAY)}function i(){d.removeClass(FLIPBOARD_CLASS_ON_PLAY),l&&(window.clearInterval(l),l=null)}var l,A,O,r,f,C,I,h=this,d=$(FLIPBOARD_SELECTOR),R=$(window),c=[],N=[],S=_.template($(CARD_TEMPLATE).html()),u=[],E=[],F=!1,L=[];this.reset=function(){e(),l&&t()},this.setup=function(e){O||(O=_.throttle(h.reset,100)),$(window).on("resize",e,O),O(e)},this.start=function(){$(window).off("resize",O),this.setup(),t()},this.stop=function(){i()}}var PHOTOS=[],PHOTOS_LOCAL,PHOTOS_FLICKR,ASPECT_RATIO=1.5,PORTRAIT_CLASS="portrait",MAX_WIDTH=240,MIN_WIDTH=175,FLIP_INTERVAL=2e3,FLIPBOARD_SELECTOR=".flipboard",FLIPBOARD_CLASS_ON_PLAY="playing",HIDE_FLIPBOARD_ON_STOP=!1,CARD_TEMPLATE="#card-template",CARD_SELECTOR="li",FRAME_SELECTOR=".flipcard",FRONT_FACE=".face.front",BACK_FACE=".face.back",TRANSITION_TIME=400,TRANSITION_TO_BACK="reveal-backface",TRANSITION_TO_FRONT="reveal-frontface",active_board;