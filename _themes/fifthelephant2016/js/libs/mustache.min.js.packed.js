(function(t,e){typeof exports=="object"&&exports?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(t.Mustache={},e(Mustache))})(this,function(t){function e(t){return typeof t=="function"}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(t,e){return t!=null&&typeof t=="object"&&e in t}function i(t,e){return v.call(t,e)}function o(t){return!i(g,t)}function s(t){return(t+"").replace(/[&<>"'\/]/g,function(t){return y[t]})}function a(e,r){function i(){if(y&&!U)while(g.length)delete v[g.pop()];else g=[];y=!1,U=!1}function s(t){if(typeof t=="string"&&(t=t.split(k,2)),!d(t)||t.length!==2)throw Error("Invalid tags: "+t);a=RegExp(n(t[0])+"\\s*"),h=RegExp("\\s*"+n(t[1])),l=RegExp("\\s*"+n("}"+t[1]))}if(!e)return[];var a,h,l,f=[],v=[],g=[],y=!1,U=!1;s(r||t.tags);var E,T,j,V,C,S,A=new p(e);while(!A.eos()){if(E=A.pos,j=A.scanUntil(a))for(var R=0,I=j.length;I>R;++R)V=j.charAt(R),o(V)?g.push(v.length):U=!0,v.push(["text",V,E,E+1]),E+=1,V==="\n"&&i();if(!A.scan(a))break;if(y=!0,T=A.scan(m)||"name",A.scan(w),T==="="?(j=A.scanUntil(x),A.scan(x),A.scanUntil(h)):T==="{"?(j=A.scanUntil(l),A.scan(b),A.scanUntil(h),T="&"):j=A.scanUntil(h),!A.scan(h))throw Error("Unclosed tag at "+A.pos);if(C=[T,j,E,A.pos],v.push(C),T==="#"||T==="^")f.push(C);else if(T==="/"){if(S=f.pop(),!S)throw Error('Unopened section "'+j+'" at '+E);if(S[1]!==j)throw Error('Unclosed section "'+S[1]+'" at '+E)}else T==="name"||T==="{"||T==="&"?U=!0:T==="="&&s(j)}if(S=f.pop())throw Error('Unclosed section "'+S[1]+'" at '+A.pos);return c(u(v))}function u(t){for(var e,n,r=[],i=0,o=t.length;o>i;++i)e=t[i],e&&(e[0]==="text"&&n&&n[0]==="text"?(n[1]+=e[1],n[3]=e[3]):(r.push(e),n=e));return r}function c(t){for(var e,n,r=[],i=r,o=[],s=0,a=t.length;a>s;++s)switch(e=t[s],e[0]){case"#":case"^":i.push(e),o.push(e),i=e[4]=[];break;case"/":n=o.pop(),n[5]=e[2],i=o.length>0?o[o.length-1][4]:r;break;default:i.push(e)}return r}function p(t){this.string=t,this.tail=t,this.pos=0}function h(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function l(){this.cache={}}var f=Object.prototype.toString,d=Array.isArray||function(t){return f.call(t)==="[object Array]"},v=RegExp.prototype.test,g=/\S/,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},w=/\s*/,k=/\s+/,x=/\s*=/,b=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/;p.prototype.eos=function(){return this.tail===""},p.prototype.scan=function(t){var e=this.tail.match(t);if(!e||e.index!==0)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},p.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},h.prototype.push=function(t){return new h(t,this)},h.prototype.lookup=function(t){var n,i=this.cache;if(i.hasOwnProperty(t))n=i[t];else{var o,s,a=this,u=!1;while(a){if(t.indexOf(".")>0){n=a.view,o=t.split("."),s=0;while(n!=null&&o.length>s)s===o.length-1&&(u=r(n,o[s])),n=n[o[s++]]}else n=a.view[t],u=r(a.view,t);if(u)break;a=a.parent}i[t]=n}return e(n)&&(n=n.call(this.view)),n},l.prototype.clearCache=function(){this.cache={}},l.prototype.parse=function(t,e){var n=this.cache,r=n[t];return r==null&&(r=n[t]=a(t,e)),r},l.prototype.render=function(t,e,n){var r=this.parse(t),i=e instanceof h?e:new h(e);return this.renderTokens(r,i,n,t)},l.prototype.renderTokens=function(t,e,n,r){for(var i,o,s,a="",u=0,c=t.length;c>u;++u)s=void 0,i=t[u],o=i[0],o==="#"?s=this.renderSection(i,e,n,r):o==="^"?s=this.renderInverted(i,e,n,r):o===">"?s=this.renderPartial(i,e,n,r):o==="&"?s=this.unescapedValue(i,e):o==="name"?s=this.escapedValue(i,e):o==="text"&&(s=this.rawValue(i)),s!==void 0&&(a+=s);return a},l.prototype.renderSection=function(t,n,r,i){function o(t){return s.render(t,n,r)}var s=this,a="",u=n.lookup(t[1]);if(u){if(d(u))for(var c=0,p=u.length;p>c;++c)a+=this.renderTokens(t[4],n.push(u[c]),r,i);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")a+=this.renderTokens(t[4],n.push(u),r,i);else if(e(u)){if(typeof i!="string")throw Error("Cannot use higher-order sections without the original template");u=u.call(n.view,i.slice(t[3],t[5]),o),u!=null&&(a+=u)}else a+=this.renderTokens(t[4],n,r,i);return a}},l.prototype.renderInverted=function(t,e,n,r){var i=e.lookup(t[1]);return!i||d(i)&&i.length===0?this.renderTokens(t[4],e,n,r):void 0},l.prototype.renderPartial=function(t,n,r){if(r){var i=e(r)?r(t[1]):r[t[1]];return i!=null?this.renderTokens(this.parse(i),n,r,i):void 0}},l.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);return n!=null?n:void 0},l.prototype.escapedValue=function(e,n){var r=n.lookup(e[1]);return r!=null?t.escape(r):void 0},l.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.1.2",t.tags=["{{","}}"];var U=new l;t.clearCache=function(){return U.clearCache()},t.parse=function(t,e){return U.parse(t,e)},t.render=function(t,e,n){return U.render(t,e,n)},t.to_html=function(n,r,i,o){var s=t.render(n,r,i);return e(o)?(o(s),void 0):s},t.escape=s,t.Scanner=p,t.Context=h,t.Writer=l});